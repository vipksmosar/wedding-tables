<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞—Å—Å–∞–¥–∫–∏ (–ø–æ–ø—Ä–∞–≤–∫–∏: –ø–æ–ø–æ–≤–µ—Ä –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–µ—Ç, —Å–Ω—è—Ç–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è)</title>

  <!-- –ü–æ–¥–∫–ª—é—á–∏–º —à—Ä–∏—Ñ—Ç Poppins (–ø—Ä–∏–º–µ—Ä —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
	  width: 100%;
    }
    body {
      font-family: "Poppins", sans-serif;
      background-color: #f5f5f5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      color: #222;
    }

    /* –®–∞–ø–∫–∞ (header) */
    header {
      background: linear-gradient(135deg, #4b6cb7, #182848);
      color: #fff;
      padding: 1rem;
      text-align: center;
      position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    header h1 {
      font-weight: 500;
      margin: 0;
    }
	
	.search-top-centered {
	  display: flex;
	  justify-content: center;
	  margin-top: 0.75rem;
	  margin-bottom: 0.5rem;
	}
    /* –ö–Ω–æ–ø–∫–∞ "–ü–æ–∏—Å–∫" –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É */
	#openSearchBtn {
	  margin-top: 0.5rem;
	  background: #4b6cb7;
	  color: white;
	  padding: 0.5rem 1rem;
	  border: none;
	  font-weight: 500;
	  border-radius: 0.4rem;
	  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
	  transition: background 0.2s;
	  font-size: 1.2rem;
	  text-transform: uppercase;
	}
	#openSearchBtn:hover {
	  background: #3955a3;
	}
    main {
      flex: 1 1 auto;
      display: flex;
      /*justify-content: center;
      align-items: center;*/
      padding: 1rem; 
	  margin: 0; 


    }

    /* -- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ª–∞ -- */
    .hall-container {
      /* width: 100%;
	  height: 100%;
	  min-height: 60vh;
      max-width: 1000px; */
	  flex: 1;
      /* aspect-ratio: 16 / 32;    –ó–∞–¥–∞—ë–º –ø—Ä–æ–ø–æ—Ä—Ü–∏—é 16:9 */  
      background: #fff;
      border-radius: 0.5rem;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    .stage,
	.podium {
      text-align: center;
      font-weight: 600;
      font-size: 1.2rem;
      background: #e0e0e0;
	  color: #333;
      width: 50%;
      margin: 1rem auto;
      padding: 0.6rem;
      border-radius: 0.5rem;
	  user-select: none;
	  pointer-events: none;
    }

    /* -- –°—Ç–æ–ª—ã -- */
    .table-block {
      position: absolute;
      width: 12%;
	  height: 7%;
      aspect-ratio: auto;
      border-radius: 0.3rem; 
      background: linear-gradient(to bottom right, #e2e8f0, #cbd5e0);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s, box-shadow 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .table-block h3 {
      font-size: 1rem;
      margin: 0;
      text-transform: uppercase;
      pointer-events: none;
      text-align: center;
    }

    /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∏–ª–∏ –∫–ª–∏–∫–µ */
    .highlight {
      background: #ff7f50 !important; /* –∑–∞–ª–∏–≤–∫–∞ "–∫–æ—Ä–∞–ª–ª" */
      color: #fff;
      box-shadow: 0 0 10px rgba(255,127,80,0.7);
    }

    /* –ü–æ–ø–æ–≤–µ—Ä (–æ–∫–æ—à–∫–æ —Å –≥–æ—Å—Ç—è–º–∏) */
    .popover {
      position: absolute;
	  max-height: 200px;
	  overflow-y: auto;
	  overflow-x: hidden;
      min-width: 120px;
	  max-width: 400px;
      background: #111;
      border-radius: 0.3rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      padding: 0.5rem;
      font-size: 0.85rem;
      z-index: 9999;
      transform: translate(-50%, -100%);
      pointer-events: none; /* —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–æ –∫–ª–∏–∫—É, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç .visible */
      opacity: 0;
      transition: opacity 0.2s;
    }
    .popover.visible {
      pointer-events: auto;
      opacity: 1;
    }
    .popover h4 {
      margin: 0 0 0.3rem;
      font-size: 0.9rem;
      border-bottom: 1px solid #ccc;
      padding-bottom: 0.2rem;
    }
    .popover ul {
      list-style: none;
      margin: 0;
      padding: 0 0 0 1rem;
    }
    .popover ul li {
      margin: 0.2rem 0;
    }
    /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–ø–æ–≤–µ—Ä–∞ (–≤ —É–≥–ª—É) */
    .popover .close-popover {
      background: none;
      border: none;
      font-size: 1rem;
      position: absolute;
      top: 0.2rem;
      right: 0.2rem;
      cursor: pointer;
      color: #888;
    }
    .popover .close-popover:hover {
      color: #444;
    }
	.popover::-webkit-scrollbar {
	  width: 6px;
	}
	.popover::-webkit-scrollbar-thumb {
	  background: rgba(255, 255, 255, 0.3);
	  border-radius: 4px;
	}

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none; /* —Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    .modal {
      background: #fff;
      padding: 1rem;
      width: 300px;
      border-radius: 0.5rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      position: relative;
    }
    .modal h2 {
      margin: 0 0 0.5rem;
      font-weight: 500;
      font-size: 1.1rem;
    }
    .modal .close-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: transparent;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #999;
    }
    .modal .close-btn:hover {
      color: #666;
    }
    .modal label {
      display: block;
      margin: 0.5rem 0 0.2rem;
      font-weight: 500;
    }
    .modal input {
      width: 100%;
      padding: 0.35rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 0.3rem;
    }
    .modal button {
      padding: 0.45rem 0.8rem;
      cursor: pointer;
      border: none;
      border-radius: 0.3rem;
      background: #4b6cb7;
      color: #fff;
      transition: background 0.2s;
    }
    .modal button:hover {
      background: #3b5ca0;
    }

    footer {
      text-align: center;
      padding: 0.5rem;
      background: #eee;
      font-size: 0.85rem;
      color: #666;
    }
	#openSearchBtnBottom {
      display: none; /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–æ (–≤–∏–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤ —à–∞–ø–∫–µ) */
      background: #1e3a8a;
      color: white;
      font-size: 1rem;
      border: none;
	  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
	  transition: background 0.3s;
      border-radius: 0.4rem;
      cursor: pointer;
	  text-transform: uppercase;
     /* margin: 0.5rem auto 0 auto;
	  padding: 0.6rem 1rem; */
    }
	
	#openSearchBtnBottom:hover {
		background: #1a2f6d;
	}

	.popover-above {
	  transform: translate(-50%, -100%);
	  top: 0;
	}
	.popover-below {
	  transform: translate(-50%, 0%);
	  top: 100%;
	}
	.guest-highlight {
	  background-color: #ffeb3b;
	  color: #000;
	  border-radius: 0.3rem;
	  padding: 0 0.3rem;
	}
	#guestModalContent div {
	  margin-bottom: 0.3rem;
	}
    /* –ê–¥–∞–ø—Ç–∏–≤ (–Ω–µ–±–æ–ª—å—à–æ–µ —É–ø—Ä–æ—â–µ–Ω–∏–µ) */
    @media (max-width: 600px) {
		body {
			font-size: 1.6rem; /* —É–≤–µ–ª–∏—á–∏—Ç—å –æ–±—â–∏–π –º–∞—Å—à—Ç–∞–± */
		}
		header h1 {
			font-size: 1.8rem; 
		}
		#openSearchBtn {
			display: none;
		}
		
		#openSearchBtnBottom {
			display: block;
			font-size: 1.4rem;
			padding: 0.6rem 1.2rem;
			background: linear-gradient(135deg, #4b6cb7, #182848);
			border: none;
			border-radius: 0.4rem;
			color: #fff;
			box-shadow: 0 2px 6px rgba(0,0,0,0.2);
		}
		/* –ø–æ–ª—è –≤–≤–æ–¥–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
		.modal input {
			font-size: 1rem;
			padding: 0.5rem;
		}

		/* —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ —Å—Ç–æ–ª–µ */
		.table-block h3 {
			font-size: 1.4rem; 
		}

		/* –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ø–æ–≤–µ—Ä–∞ */
		.popover h4 {
			font-size: 1.1rem;
		}
		.popover li {
			font-size: 1.1rem;
		}
		.table-block {
		   width: 16% !important;
		   height: 12% !important;
		   margin-bottom: 1rem;
		}
		.stage {
			font-size: 1.4rem;
			padding: 0.4rem;
			width: 60%;
		}
		.hall-container {
			max-height: 80vh;
			overflow-y: auto;
		}
    }
	@media (max-width: 300px) {
		.label-text {
			display: none;
		}
	}
	@media (min-width: 601px) and (max-width: 900px) {
	  .table-block {
			width: 16%;
		}	
	  .table-block h3 {
			font-size: 1.4rem;
		}
	}
	@media (orientation: landscape) {
	  .hall-container {
		height: 100vh;
		overflow-y: auto;
	  }
	}

  </style>
</head>
<body>

<header>
  <h1>–°—Ö–µ–º–∞ —Ä–∞—Å—Å–∞–¥–∫–∏</h1>
</header>
<div class="search-top-centered">
	<button id="openSearchBtn">üîç –ù–∞–π—Ç–∏ –≥–æ—Å—Ç—è –ø–æ —Ñ–∞–º–∏–ª–∏–∏</button>
</div>
<main>
  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ª–∞ -->
  <div class="hall-container" id="hallContainer">
    <div class="stage" tabindex="-1">–°–¶–ï–ù–ê</div>
    <!-- –°—Ç–æ–ª—ã –ø–æ—è–≤—è—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
  </div>
</main>
<div class="podium" tabindex="-1">–ü–†–ï–ó–ò–î–ò–£–ú</div>
<button id="openSearchBtnBottom">–ü–æ–∏—Å–∫</button>
<footer>
	<!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∏—Å–∫–∞ (–º–æ–±–∏–ª—å–Ω–∞—è) -->
  ¬© 2025 –°—Ö–µ–º–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
</footer>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <button class="close-btn" id="closeModalBtn">√ó</button>
    <h2>–ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–º–∏–ª–∏–∏</h2>
    <label for="searchInput">–§–∞–º–∏–ª–∏—è:</label>
    <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é..." />
    <button id="searchBtn">–ù–∞–π—Ç–∏</button>
  </div>
</div>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥–æ—Å—Ç–µ–π -->
<div class="modal-overlay" id="guestModalOverlay">
  <div class="modal">
    <button class="close-btn" id="closeGuestModalBtn">√ó</button>
    <h2 id="guestModalTitle">–ì–æ—Å—Ç–∏ —Å—Ç–æ–ª–∞</h2>
    <div id="guestModalContent"></div>
  </div>
</div>
<script>
// --------------------- –î–ê–ù–ù–´–ï ---------------------
const tablesData = [
  { id: 1, left: 10,  top: 15, guests: ["–ò–≤–∞–Ω–æ–≤", "–ü–µ—Ç—Ä–æ–≤", "–°–∏–¥–æ—Ä–æ–≤", "–ú–∏—Ö–∞–π–ª–æ–≤", "–§—ë–¥–æ—Ä–æ–≤", "–ö—É–∑–Ω–µ—Ü–æ–≤", "–ï–≥–æ—Ä–æ–≤", "–ó–∞–π—Ü–µ–≤"] },
  { id: 2, left: 15,  top: 30, guests: ["–ê–ª–µ–∫—Å–µ–µ–≤", "–í–∞—Å–∏–ª—å–µ–≤", "–ì—Ä–∏–≥–æ—Ä—å–µ–≤", "–ñ—É–∫–æ–≤", "–ò–ª—å–∏–Ω", "–ö—Ä—ã–ª–æ–≤", "–õ–µ–±–µ–¥–µ–≤", "–ú–∞–∫–∞—Ä–æ–≤"] },
  { id: 3, left: 20,  top: 45, guests: ["–ù–∏–∫–∏—Ç–∏–Ω", "–û—Ä–ª–æ–≤", "–ü–∞–≤–ª–æ–≤", "–†–æ–º–∞–Ω–æ–≤", "–°–µ–º–µ–Ω–æ–≤", "–¢–∞—Ä–∞—Å–æ–≤", "–£—à–∞–∫–æ–≤", "–§—Ä–æ–ª–æ–≤"] },
  { id: 4, left: 10,  top: 60, guests: ["–•–∞—Ä–∏—Ç–æ–Ω–æ–≤", "–¶–≤–µ—Ç–∫–æ–≤", "–ß–∏—Å—Ç–æ–≤", "–®–µ—Å—Ç–∞–∫–æ–≤", "–©–µ—Ä–±–∞–∫–æ–≤", "–≠–º–∏—Ä–æ–≤", "–Æ–¥–∏–Ω", "–Ø–∫–æ–≤–ª–µ–≤"] },
  { id: 5, left: 15,  top: 75, guests: ["–ê–±—Ä–∞–º–æ–≤", "–ë–µ–ª—è–µ–≤", "–í–∏–Ω–æ–≥—Ä–∞–¥–æ–≤", "–ì–æ—Ä—à–∫–æ–≤", "–î–µ–º–∏–¥–æ–≤", "–ï—Ä—à–æ–≤", "–ñ–¥–∞–Ω–æ–≤", "–ó–ª–æ–±–∏–Ω"] },
  { id: 6, right: 10, top: 15, guests: ["–ò–≥–Ω–∞—Ç–æ–≤", "–ö–ª–∏–º–æ–≤", "–õ–∞–ø–∏–Ω", "–ú–∞—Ä—Ç—ã–Ω–æ–≤", "–ù–æ—Å–æ–≤", "–û–≤—á–∏–Ω–Ω–∏–∫–æ–≤", "–ü–æ–Ω–æ–º–∞—Ä—ë–≤", "–†—è–±–æ–≤"] },
  { id: 7, right: 15, top: 30, guests: ["–°–æ–ª–æ–≤—å–µ–≤", "–¢–∏—Ö–æ–Ω–æ–≤", "–£–≤–∞—Ä–æ–≤", "–§–µ–¥–æ—Å–µ–µ–≤", "–•–æ—Ö–ª–æ–≤", "–¶–∞—Ä–µ–≤", "–ß–∏–∂–æ–≤", "–®–∞–ø–æ–≤–∞–ª–æ–≤"] },
  { id: 8, right: 20, top: 45, guests: ["–©—É–∫–∏–Ω", "–≠—Ä—Ç–µ–ª—å", "–Æ–º–∞—à–µ–≤", "–Ø—à–∏–Ω", "–ê–Ω–∏—Å–∏–º–æ–≤", "–ë—É—Ä–æ–≤", "–í–æ—Ä–æ–Ω—Ü–æ–≤", "–ì–∞–≤—Ä–∏–ª–æ–≤"] },
  { id: 9, right: 10, top: 60, guests: ["–î—å—è—á–∫–æ–≤", "–ï–≤—Å–µ–µ–≤", "–ñ–∞—Ä–∫–æ–≤", "–ó–æ—Ç–æ–≤", "–ò—Å–∞–µ–≤", "–ö–∞—Ä–ø–æ–≤", "–õ–∞–≤—Ä–æ–≤", "–ú–µ—â–µ—Ä—è–∫–æ–≤"] },
  { id: 10, right: 15, top: 75, guests: ["–ù–∏–∫–∏—Ñ–æ—Ä–æ–≤ –î–µ–Ω–∏—Å", "–û–∑–µ—Ä–Ω–æ–≤", "–ü–µ—Å—Ç–æ–≤", "–†—É—Å–∞–∫–æ–≤", "–°–∞–≤–∏–Ω", "–¢–∏—Ç–æ–≤", "–£–ª—å—è–Ω–æ–≤", "–§–æ–º–∏–Ω"] }
];
const hallContainer = document.getElementById("hallContainer");

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞
const modalOverlay = document.getElementById("modalOverlay");
const closeModalBtn = document.getElementById("closeModalBtn");
const openSearchBtn = document.getElementById("openSearchBtn");
const openSearchBtnBottom = document.getElementById("openSearchBtnBottom");
const searchBtn = document.getElementById("searchBtn");
const searchInput = document.getElementById("searchInput");

const guestModalOverlay = document.getElementById("guestModalOverlay");
const guestModalTitle = document.getElementById("guestModalTitle");
const guestModalContent = document.getElementById("guestModalContent");
const closeGuestModalBtn = document.getElementById("closeGuestModalBtn");

// –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–æ–ª (ID) + –ø–æ–ø–æ–≤–µ—Ä
let currentSelectedTableId = null;

// --------------------- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---------------------
renderTables();
openSearchBtn.addEventListener("click", openModal);
closeModalBtn.addEventListener("click", closeModal);
openSearchBtnBottom.addEventListener("click", openModal);
searchBtn.addEventListener("click", searchGuest);
searchInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    searchGuest();
  }
});


closeGuestModalBtn.addEventListener("click", () => {
  guestModalOverlay.style.display = "none";
});
// –ö–ª–∏–∫ –ø–æ –æ–≤–µ—Ä–ª–µ—é - –∑–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É, –µ—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è
modalOverlay.addEventListener("click", (e) => {
  if (e.target === modalOverlay) closeModal();
});

// --------------------- –§–£–ù–ö–¶–ò–ò ---------------------

function showGuestModal(table, highlightQuery = "") {
  guestModalTitle.textContent = `–°—Ç–æ–ª #${table.id}`;
  guestModalContent.innerHTML = ""; // –æ—á–∏—Å—Ç–∏—Ç—å

  table.guests.forEach(name => {
    const line = document.createElement("div");
    if (highlightQuery && name.toLowerCase().includes(highlightQuery)) {
      line.classList.add("guest-highlight");
    }
    line.textContent = name;
    guestModalContent.appendChild(line);
  });

  guestModalOverlay.style.display = "flex";
}

function renderTables() {
  tablesData.forEach(table => {
    const tableDiv = document.createElement("div");
    tableDiv.classList.add("table-block");
    if (typeof table.left !== "undefined") {
      tableDiv.style.left = table.left + "%";
    } else if (typeof table.right !== "undefined") {
      tableDiv.style.right = table.right + "%";
    }
    tableDiv.style.top = table.top + "%";
    tableDiv.dataset.tableId = table.id;

    const h3 = document.createElement("h3");
    h3.innerHTML = `<span class="label-text">–°–¢–û–õ</span> <span class="label-number">#${table.id}</span>`;
    tableDiv.appendChild(h3);

    const handleClick = (e) => {
      e.stopPropagation();
      const clickedId = table.id;

      if (currentSelectedTableId === clickedId) {
        removeHighlight(clickedId);
        removePopover(clickedId);
        currentSelectedTableId = null;
        return;
      }

      if (currentSelectedTableId !== null) {
        removeHighlight(currentSelectedTableId);
        removePopover(currentSelectedTableId);
      }

      tableDiv.classList.add("highlight");
      currentSelectedTableId = clickedId;
      //showPopover(table, tableDiv);
	  showGuestModal(table);
    };

    tableDiv.addEventListener("click", handleClick);
    tableDiv.addEventListener("touchstart", (e) => {
	  e.preventDefault(); // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
	  handleClick(e);
	}, { passive: false }); // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º passive: false, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª preventDefault

    //enableDragAndDrop(tableDiv);
    hallContainer.appendChild(tableDiv);
  });
}

function showPopover(table, tableDiv) {
  removeExistingPopovers();

  const popover = document.createElement("div");
  popover.classList.add("popover");
  popover.dataset.forTableId = table.id;

  const closeBtn = document.createElement("button");
  closeBtn.classList.add("close-popover");
  closeBtn.textContent = "√ó";
  closeBtn.addEventListener("click", () => {
    removeHighlight(table.id);
    removePopover(table.id);
    if (currentSelectedTableId === table.id) currentSelectedTableId = null;
  });
  popover.appendChild(closeBtn);

  const title = document.createElement("h4");
  title.textContent = `–°—Ç–æ–ª #${table.id}`;
  popover.appendChild(title);

  const ul = document.createElement("ul");
  table.guests.forEach(g => {
    const li = document.createElement("li");
    li.textContent = g;
    ul.appendChild(li);
  });
  popover.appendChild(ul);

  // –í—Å—Ç–∞–≤–∏–º, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∏–∑–º–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã
  tableDiv.appendChild(popover);

  requestAnimationFrame(() => {
    const containerRect = hallContainer.getBoundingClientRect();
    const popoverRect = popover.getBoundingClientRect();
    const tableRect = tableDiv.getBoundingClientRect();

    const spaceAbove = tableRect.top - containerRect.top;
    const spaceBelow = containerRect.bottom - tableRect.bottom;
    const spaceRight = containerRect.right - tableRect.right;
    const spaceLeft = tableRect.left - containerRect.left;

    let direction;
    if (spaceBelow > popoverRect.height) {
      direction = "bottom";
      popover.style.top = "100%";
      popover.style.left = "50%";
      popover.style.transform = "translate(-50%, 0)";
    } else if (spaceAbove > popoverRect.height) {
      direction = "top";
      popover.style.top = "0";
      popover.style.left = "50%";
      popover.style.transform = "translate(-50%, -100%)";
    } else if (spaceRight > popoverRect.width) {
      direction = "right";
      popover.style.top = "50%";
      popover.style.left = "100%";
      popover.style.transform = "translate(0, -50%)";
    } else {
      direction = "left";
      popover.style.top = "50%";
      popover.style.left = "0";
      popover.style.transform = "translate(-100%, -50%)";
    }

    popover.classList.add("visible");
	['click', 'touchstart'].forEach(eventName => {
		document.addEventListener(eventName, handleOutsideClick);
	  });

	  function handleOutsideClick(e) {
		const isClickInsidePopover = popover.contains(e.target);
		const isClickInsideTable = tableDiv.contains(e.target);
		if (!popover.contains(e.target)) {
		  removeHighlight(table.id);
		  removePopover(table.id);
		  currentSelectedTableId = null;
		  ['click', 'touchstart'].forEach(eventName => {
			document.removeEventListener(eventName, handleOutsideClick);
		  });
		}
	  }
  });
}


function removePopover(tableId) {
  const pop = document.querySelector(`.popover[data-for-table-id='${tableId}']`);
  if (pop) pop.remove();
}
function removeExistingPopovers() {
  document.querySelectorAll(".popover").forEach(p => p.remove());
}
function removeHighlight(tableId) {
  const tDiv = hallContainer.querySelector(`[data-table-id='${tableId}']`);
  if (tDiv) tDiv.classList.remove("highlight");
}

// –ü–æ–∏—Å–∫
function searchGuest() {
  const query = searchInput.value.trim().toLowerCase();
  const allTables = hallContainer.querySelectorAll(".table-block");
  allTables.forEach(t => t.classList.remove("highlight"));

  if (!query) {
    closeModal();
    return;
  }

  let foundAny = false;

  tablesData.forEach(table => {
    const match = table.guests.some(g => g.toLowerCase().includes(query));
    if (match) {
      const tDiv = hallContainer.querySelector(`[data-table-id='${table.id}']`);
      if (tDiv) {
        tDiv.classList.add("highlight");
        showGuestModal(table, query);
      }
      foundAny = true;
    }
  });

  if (!foundAny) alert("–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!");
  closeModal();
}

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
function openModal() {
  modalOverlay.style.display = "flex";
  searchInput.value = "";
  searchInput.focus();
}
function closeModal() {
  modalOverlay.style.display = "none";
}

</script>
</body>
</html>
